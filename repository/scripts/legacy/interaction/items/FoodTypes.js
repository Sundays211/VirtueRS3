/**
 * Copyright (c) 2014 Virtue Studios
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions\:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

/**
 * @author Im Frizzy <skype:kfriz1998>
 * @author Frosty Teh Snowman <skype:travis.mccorkle>
 * @author Arthur <skype:arthur.behesnilian>
 * @author Kayla <skype:ashbysmith1996>
 * @author Sundays211
 * @since 24/01/2015
 */
 
 var Types = {
 	    ANCHOVIES : {
			itemID : 319,
			healAmount : 200,
	        delayTime : 1,
	        healText : null
	    },
	    BREAD : {
			itemID : 2309,
			healAmount : 200,
	        delayTime : 1,
	        healText : null
	    },
	    CRAYFISH : {
			itemID : 13433,
			healAmount : 200,
	        delayTime : 1,
	        healText : null
	    },
 	    CHICKEN : {
			itemID : 2140,
			healAmount : 200,
	        delayTime : 1,
	        healText : null
	    },
	    MEAT : {
			itemID : 2142,
			healAmount : 200,
	        delayTime : 1,
	        healText : null
	    },
	    SHRIMP : {
			itemID : 315,
			healAmount : 200,
	        delayTime : 1,
	        healText : null
	    },
	    SARDINE : {
			itemID : 325,
			healAmount : 200,
	        delayTime : 1,
	        healText : null
	    },
	    HERRING : {
			itemID : 347,
			healAmount : 200,
	        delayTime : 1,
	        healText : null
	    },
	    MACKEREL : {
			itemID : 355,
			healAmount : 200,
	        delayTime : 1,
	        healText : null
	    },
	    TROUT : {
			itemID : 333,
			healAmount : 375,
	        delayTime : 1,
	        healText : null
	    },
	    COD : {
			itemID : 339,
			healAmount : 450,
	        delayTime : 1,
	        healText : null
	    },
	    PIKE : {
			itemID : 351,
			healAmount : 500,
	        delayTime : 1,
	        healText : null
	    },
	    SALMON : {
			itemID : 329,
			healAmount : 625,
	        delayTime : 1,
	        healText : null
	    },
	    TUNA : {
			itemID : 361,
			healAmount : 750,
	        delayTime : 1,
	        healText : null
	    },
	    BASS : {
			itemID : 365,
			healAmount : 1300,
	        delayTime : 1,
	        healText : null
	    },
	    LOBSTER : {
			itemID : 379,
			healAmount : 1200,
	        delayTime : 1,
	        healText : null
	    },
	    SWORDFISH : {
			itemID : 373,
			healAmount : 1400,
	        delayTime : 1,
	        healText : null
	    },
	    MONKFISH : {
			itemID : 7946,
			healAmount : 1600,
	        delayTime : 1,
	        healText : null
	    },	    	    	    	    	    	     	  	    	    	    
 	    SHARK : {
			itemID : 385,
			healAmount : 2000,
	        delayTime : 1,
	        healText : null
	    },
	    SEA_TURTLE : {
			itemID : 397,
			healAmount : 2050,
	        delayTime : 1,
	        healText : null
	    },
	    CAVEFISH : {
			itemID : 15266,
			healAmount : 2200,
	        delayTime : 1,
	        healText : null
	    },	    	    	    
		MANTA_RAY : {
			itemID : 391,
			healAmount : 2275,
	        delayTime : 1,
	        healText : null
	    },
	    ROCKTAIL : {
			itemID : 15272,
			healAmount : 2300,
	        delayTime : 1,
	        healText : null
	    },
	    ROCKTAIL : {
			itemID : 15272,
			healAmount : 2300,
	        delayTime : 1,
	        healText : null
	    },
	    CAKE	 : {
			itemID : 1891,
			healAmount : 999,
	        delayTime : 1,
	        healText : null
	    },
	    CHOCOLATE_CAKE : {
			itemID : 1897,
			healAmount : 1248,
	        delayTime : 1,
	        healText : null
	    },
	    CHOCOLATE_BAR : {
	    	itemID : 1973,
	    	healAmount : 200,
	    	healText : null
	    },
	    PLAIN_PIZZA : {
			itemID : 2289,
			healAmount : 875,
	        delayTime : 1,
	        healText : null
	    },
	    MEAT_PIZZA : {
			itemID : 2293,
			healAmount : 1125,
	        delayTime : 1,
	        healText : null
	    },
	    ANCHOVY_PIZZA : {
			itemID : 2297,
			healAmount : 1375,
	        delayTime : 1,
	        healText : null
	    },
	    PINEAPPLE_PIZZA : {
			itemID : 2301,
			healAmount : 1625,
	        delayTime : 1,
	        healText : null
	    },
	    GARDEN_PIE : {
			itemID : 7178,
			healAmount : 850,
	        delayTime : 1,
	        healText : null
	    },
	    POTATO_WITH_CHEESE : {
			itemID : 6705,
			healAmount : 1175,
	        delayTime : 1,
	        healText : null
	    },
	    EGG_POTATO : {
			itemID : 7056,
			healAmount : 1375,
	        delayTime : 1,
	        healText : null
	    },
	    TUNA_POTATO : {
			itemID : 7060,
			healAmount : 2125,
	        delayTime : 1,
	        healText : null
	    },
	    WILD_PIE : {
			itemID : 7208,
			healAmount : 2125,
	        delayTime : 1,
	        healText : null
	    },
	    SUMMER_PIE : {
			itemID : 7218,
			healAmount : 2375,
	        delayTime : 1,
	        healText : null
	    },
	    TIGER_SHARK : {
			itemID : 21521,
			healAmount : 1900,
	        delayTime : 1,
	        healText : null
	    },
	    BARON_SHARK : {
			itemID : 19948,
			healAmount : 2000,
	        delayTime : 1,
	        healText : null
	    },
	    JUJU_GUMBO : {
			itemID : 19949,
			healAmount : 2300,
	        delayTime : 1,
	        healText : null
	    },
	    ROCKTAIL_SOUP : {
			itemID : 26313,
			healAmount : 2400,
	        delayTime : 1,
	        healText : null
	    },
	    SARADOMIN_BREW : {
			itemID : 6685,
			healAmount : 4000,
	        delayTime : 1,
	        healText : null
	    },
	    SARADOMIN_BREW_FLASK : {
			itemID : 23351,
			healAmount : 6000,
	        delayTime : 1,
	        healText : null
	    },
	    SUPER_SARADOMIN_BREW : {
			itemID : 28191,
			healAmount : 5200,
	        delayTime : 1,
	        healText : null
	    },
	    SUPER_SARADOMIN_BREW_FLASK : {
			itemID : 28227,
			healAmount : 7800,
	        delayTime : 1,
	        healText : null
	    }	    			    		    		    	   
};
 
var ItemListener = Java.extend(Java.type('org.virtue.engine.script.listeners.EventListener'), {
	invoke : function (event, objTypeId, args) {
		var player = args.player;
		var item = args.item;
		var slot = args.slot;
		
		startFood(player, item, slot);
	}
});

/* Listen to the item ids specified */
var listen = function(scriptManager) {
	var ids = [ 1973, 319, 2309, 13433, 2140, 2142, 315, 325, 347, 355, 333, 339, 351, 
	    		329, 361, 365, 379, 373, 7946, 385, 397, 15266, 391, 15272, 1891, 1897, 2289, 
	    		2293, 2297, 2301, 7178, 6705, 7056, 7060, 7208, 7218, 21521, 19948, 19949, 26313, 6685, 23351, 28191, 28227 ];
	var itemListener = new ItemListener();
	for (var i in ids) {
		scriptManager.registerListener(EventType.OPHELD1, ids[i], itemListener);
	}
}

function startFood (player, item, slot) {
	if (api.isPaused(player)) {
		return false;
	}
	var food = forFood(player, item);
	if (food == null) {
		return;
	}
	var delay = 2;
	api.freezeEntity(player, delay+1);
	if (food.healText != null) {
		api.sendFilterMessage(player, food.healText);		
	} else {
		api.sendFilterMessage(player, "You eat the " + api.getItemName(food.itemID) + ".");
	}
	if(player.getCombat().inCombat() == true) {
		api.runAnimation(player, 18002);
	} else {
		api.runAnimation(player, 18001);
	}
	player.getImpactHandler().heal(food.healAmount, true);
	api.delCarriedItem(player, item.getID(), 1, slot);
	var Action = Java.extend(Java.type('org.virtue.game.entity.player.event.PlayerActionHandler'), {	
			process : function (player) {
				if (delay <= 0) {
					api.sendFilterMessage(player, "It heals some health.");
					return true;
				}
				delay--;
				return false;
			},
			stop : function (player) {//Clear the current animation block
				api.stopAnimation(player);
			}
		
		});
		player.setAction(new Action());	
}

//Get Food Delay to stop all actions until animation is over, then re-continue the action
function getDelay (player, types) {
	var timer = 1;
	print(timer+"\n");
	if (timer < 1 + types.delayTime) {
		timer = 1 + Math.floor((Math.random() * types.delayTime));
		print(timer+"\n");
	}
	return timer;
}

//Call correct food name
function forFood(player, item) {
	var food;
	for (ordial in Types) {
		food = Types[ordial];
		if (food.itemID == item.getID()) {
			return food;
		}
	}
	return null;
} 